{% load tailwind_tags %} {% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    {% tailwind_css %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ student.name }} - Documents</title>
  </head>

  <body class="bg-gray-100 p-10">
    <div class="max-w-5xl mx-auto">
      <!-- TOP BAR -->
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">
          Documents of {{ student.name }}
        </h1>

        <div class="flex gap-3">
          <!-- ISSUE DOCUMENT BUTTON -->
          <button
            onclick="document.getElementById('issueModal').showModal()"
            class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg shadow-md"
          >
            + Issue Document
          </button>

          <!-- ADD DOCUMENT BUTTON -->
          <button
            onclick="document.getElementById('addModal').showModal()"
            class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg shadow-md"
          >
            + Add Document
          </button>
        </div>
      </div>

      <!-- DOCUMENT TABLE -->
      <div class="bg-white shadow-md rounded-lg overflow-hidden mb-10">
        <table class="min-w-full leading-normal">
          <thead>
            <tr>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                S.No
              </th>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                Doc_No
              </th>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                Document Name
              </th>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                Issued By
              </th>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                Issued To
              </th>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                Issued Date
              </th>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                File
              </th>
              <th
                class="px-5 py-3 bg-gray-100 text-left text-xs font-semibold uppercase"
              >
                Status
              </th>
            </tr>
          </thead>

          <tbody>
            {% for doc in documents %}
            <tr class="hover:bg-gray-50">
              <td class="px-5 py-3 border-b">{{ forloop.counter }}</td>
              <td class="px-5 py-3 border-b font-medium">{{ doc.doc_no }}</td>
              <td class="px-5 py-3 border-b font-medium">
                {{ doc.document_name }}
              </td>

              <!-- UPDATED: ISSUED BY COLLEGE -->
              <td class="px-5 py-3 border-b font-semibold">
                {% if doc.issued_by_college %}
                <span class="text-green-700"
                  >{{ doc.issued_by_college.college_name }}</span
                >
                {% else %}
                <span class="text-red-700">Not Found</span>
                {% endif %}
              </td>

              <td class="px-5 py-3 border-b">{{ doc.issued_to }}</td>
              <td class="px-5 py-3 border-b">{{ doc.issued_date }}</td>

              <td class="px-5 py-3 border-b">
                <a
                  href="{{ doc.file.url }}"
                  target="_blank"
                  class="text-blue-600 underline"
                  >View</a
                >
              </td>

              <!-- UPDATED STATUS DISPLAY -->
              <td class="px-5 py-3 border-b">
                {% if doc.status == "Verified" %}
                <span
                  class="px-2 py-1 text-sm rounded bg-green-200 text-green-800"
                  >Verified</span
                >

                {% elif doc.status == "Pending" %}
                <span
                  class="px-2 py-1 text-sm rounded bg-yellow-200 text-yellow-800"
                  >Pending</span
                >

                {% elif doc.status == "Fake" %}
                <span class="px-2 py-1 text-sm rounded bg-red-200 text-red-800"
                  >Fake</span
                >

                {% elif doc.status == "Issued" %}
                <span
                  class="px-2 py-1 text-sm rounded bg-blue-200 text-blue-800"
                  >Issued</span
                >

                {% else %}
                <span
                  class="px-2 py-1 text-sm rounded bg-gray-200 text-gray-800"
                  >{{ doc.status }}</span
                >
                {% endif %}
              </td>
            </tr>

            {% empty %}
            <tr>
              <td colspan="8" class="text-center py-6 text-gray-500">
                No documents uploaded yet.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ADD DOCUMENT MODAL -->
      <dialog id="addModal" class="p-5 rounded-lg shadow-lg w-1/3">
        <h2 class="text-xl font-bold mb-4">Upload Document</h2>
        <form method="POST" enctype="multipart/form-data" class="space-y-4">
          {% csrf_token %} {{ add_form.as_p }}
          <div class="flex justify-end gap-3">
            <button
              type="button"
              onclick="document.getElementById('addModal').close()"
              class="px-4 py-2 bg-gray-300 rounded-lg"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg"
            >
              Upload
            </button>
          </div>
        </form>
      </dialog>

      <!-- ISSUE DOCUMENT MODAL -->
      <dialog id="issueModal" class="p-5 rounded-lg shadow-lg w-1/3">
        <h2 class="text-xl font-bold mb-4">Issue Document</h2>
        <form method="POST" enctype="multipart/form-data" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="issue_document" value="true" />
          {{ issue_form.as_p }}
          <div class="flex justify-end gap-3">
            <button
              type="button"
              onclick="document.getElementById('issueModal').close()"
              class="px-4 py-2 bg-gray-300 rounded-lg"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-green-600 text-white rounded-lg"
            >
              Issue
            </button>
          </div>
        </form>
      </dialog>
    </div>
  </body>
</html>
